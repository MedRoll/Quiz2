<!DOCTYPE html>
<html lang="it">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Quiz Interattivo Completo</title>
Â  <style>
Â  Â  /* --- STILI BASE --- */
Â  Â  html { font-size: 16px; scroll-behavior: smooth; }
Â  Â  body { font-family: 'Segoe UI', sans-serif; background-color: #1c1f2b; color: #fff; padding: 20px; max-width: 900px; margin: auto; }
Â  Â  h1 { text-align: center; color: #1a73e8; margin-bottom: 30px; }
Â  Â  .stats { display: flex; justify-content: space-between; margin-bottom: 15px; }
Â  Â  .card { background-color: #2a2e3d; color: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }

Â  Â  /* --- RISPOSTE --- */
Â  Â  .risposta {Â 
Â  Â  Â  background-color: #ffffff;Â 
Â  Â  Â  color: #000;Â 
Â  Â  Â  border: 2px solid #ccc;Â 
Â  Â  Â  margin: 10px 0;Â 
Â  Â  Â  padding: 15px 20px;Â 
Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  font-size: 1.2rem;Â 
Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  transition: all 0.25s ease-in-out;Â 
Â  Â  Â  opacity: 0;Â 
Â  Â  Â  transform: translateY(10px);Â 
Â  Â  Â  animation: fadeInUp 0.6s ease forwards;Â 
Â  Â  }
Â  Â  .risposta:hover { transform: scale(1.03); box-shadow: 0 0 12px rgba(255,255,255,0.3); }
Â  Â  .corretta { background-color: #28a745; color: white; border-color: #28a745; }
Â  Â  .sbagliata { background-color: #dc3545; color: white; border-color: #dc3545; }

Â  Â  /* --- BOTTONI --- */
Â  Â  button {Â 
Â  Â  Â  padding: 10px 16px;Â 
Â  Â  Â  margin: 5px;Â 
Â  Â  Â  border: none;Â 
Â  Â  Â  border-radius: 6px;Â 
Â  Â  Â  background-color: #1a73e8;Â 
Â  Â  Â  color: white;Â 
Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  transition: all 0.25s ease-in-out;
Â  Â  Â  opacity: 0;Â 
Â  Â  Â  transform: translateY(10px);Â 
Â  Â  Â  animation: fadeInUp 0.6s ease forwards;Â 
Â  Â  }
Â  Â  button:hover { background-color: #155ab6; transform: scale(1.07); box-shadow: 0px 0px 15px rgba(26,115,232,0.6); }
Â  Â  button:active { transform: scale(0.95); box-shadow: 0px 0px 8px rgba(0,0,0,0.3) inset; }
Â  Â  .btn-danger { background-color: #d93025; }
Â  Â  .btn-danger:hover { background-color: #b5271b; }

Â  Â  /* --- GRIGLIA MODULI --- */
Â  Â  .moduli-grid {
Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  grid-template-columns: 1fr;Â 
Â  Â  Â  Â  gap: 10px;Â 
Â  Â  Â  Â  max-width: 600px;Â 
Â  Â  Â  Â  margin: auto;
Â  Â  }

Â  Â  /* --- RECAP --- */
Â  Â  #risposte { display: grid; gap: 1rem; }
Â  Â  .domandaRecap { background-color: #2f3347; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
Â  Â  .domandaRecap strong { display: block; margin-bottom: 6px; font-size: 1.1em; color: #1a73e8; }
Â  Â  .domandaRecap div { margin: 4px 0; }

Â  Â  /* --- ANIMAZIONI --- */
Â  Â  @keyframes fadeInUp {
Â  Â  Â  from { opacity: 0; transform: translateY(20px); }
Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }
Â  Â  .progress-bar-animate {
Â  Â  Â  transition: width 0.4s ease-in-out;
Â  Â  }
Â  </style>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body>
Â Â 
Â  <div id="start-container" style="text-align: center; margin-bottom: 30px;">
Â  Â  <h1>Benvenuto!</h1>
Â  Â  <button onclick="setDocenteMode(false)">ğŸ“ ModalitÃ  Studente</button>
Â  Â  <button onclick="setDocenteMode(true)">ğŸ‘©â€ğŸ« ModalitÃ  Docente</button>
Â  </div>

Â  <div id="quiz-buttons" style="margin-top:20px; display:none; text-align:center;">
Â  Â  <h2 id="quiz-title"></h2>
Â  Â Â 
Â  Â  <div id="lezione-container" style="max-width: 600px; margin: 10px auto; display: none;">
Â  Â  Â  <button onclick="mostraModuliQuiz(1)" style="width: 100%; font-size: 1.3rem; padding: 20px; margin-bottom: 15px;">
Â  Â  Â  Â  ğŸ“š Lezione 1: Anatomia e Fondamenti
Â  Â  Â  </button>
Â  Â  Â  <button onclick="mostraModuliQuiz(2)" style="width: 100%; font-size: 1.3rem; padding: 20px; margin-bottom: 15px; background-color: #6f42c1;">
Â  Â  Â  Â  ğŸš€ Lezione 2: Office & ProduttivitÃ 
Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="mostraModuliQuiz(3)" style="width: 100%; font-size: 1.3rem; padding: 20px; background-color: #008080;">
Â  Â  Â  Â  ğŸŒ Lezione 3: Internet & Rete
Â  Â  Â  </button>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="moduli-lezione-1" class="moduli-grid">
Â  Â  Â  <h3 style="color: #1a73e8; margin-top:0;">Lezione 1: Fondamenti</h3>
Â  Â  Â  <button onclick="iniziaQuiz(1)">ğŸ–¥ï¸ Modulo 1 - Hardware & Anatomia</button>
Â  Â  Â  <button onclick="iniziaQuiz(2)">ğŸ–±ï¸ Modulo 2 - Mouse & Tastiera</button>
Â  Â  Â  <button onclick="iniziaQuiz(3)">ğŸªŸ Modulo 3 - Ambiente Windows</button>
Â  Â  Â  <button onclick="iniziaQuiz(4)">â˜ï¸ Modulo 4 - Digitale & Sicurezza</button>
Â  Â  Â  <button onclick="iniziaQuiz(5)" style="opacity: 0.8; border: 1px solid #1a73e8;">ğŸ“ Esercizi #5</button>
Â  Â  </div>

Â  Â  <div id="moduli-lezione-2" class="moduli-grid">
Â  Â  Â  <h3 style="color: #6f42c1; margin-top:0;">Lezione 2: ProduttivitÃ </h3>
Â  Â  Â  <button onclick="iniziaQuiz(6)" style="background-color: #2b5797;">ğŸ“ Modulo 6 - Esercizi #1</button>
Â  Â  Â  <button onclick="iniziaQuiz(7)" style="background-color: #217346;">ğŸ“Š Modulo 7 - Esercizi #2</button>
Â  Â  Â  <button onclick="iniziaQuiz(8)" style="background-color: #d24726;">ğŸ“¢ Modulo 8 - Esercizi #3</button>
Â  Â  Â  <button onclick="iniziaQuiz(9)" style="background-color: #0078d4;">ğŸ“§ Modulo 9 - Esercizi #4</button>
Â  Â  Â  <button onclick="iniziaQuiz(10)" style="opacity: 0.8; background-color: #6f42c1; border: 1px solid white;">ğŸ“ Esercizi #5</button>
Â  Â  </div>

Â  Â  Â  Â  <div id="moduli-lezione-3" class="moduli-grid">
Â  Â  Â  <h3 style="color: #008080; margin-top:0;">Lezione 3: Internet e Reti</h3>
Â  Â  Â  <button onclick="iniziaQuiz(11)" style="background-color: #00a0a0;">ğŸŒ Modulo 11 - Esercizi #1</button>
Â  Â  Â  <button onclick="iniziaQuiz(12)" style="background-color: #006060;">ğŸ”— Modulo 12 - Esercizi #2</button>
Â  Â  Â  <button onclick="iniziaQuiz(13)" style="background-color: #009090;">ğŸ”’ Modulo 13 - Esercizi #3</button>
Â  Â  Â  <button onclick="iniziaQuiz(14)" style="background-color: #007070;">ğŸ“¡ Modulo 14 - Esercizi #4</button>
Â  Â  Â  <button onclick="iniziaQuiz(15)" style="opacity: 0.8; background-color: #008080; border: 1px solid white;">ğŸ“ Esercizi #5</button>
Â  Â  </div>
Â  Â  Â  Â  <div style="margin-top:25px;">
Â  Â  Â  <button id="btn-back-lezione" onclick="tornaAlleLezioni()" style="background-color: #6c757d; display:none;">â¬…ï¸ Cambia Lezione</button>
Â  Â  Â  <button id="btn-back-mode" onclick="tornaAllaModalita()" style="background-color: #444;">â¬…ï¸ Torna alla scelta modalitÃ </button>
Â  Â  </div>
Â  </div>

Â  <h1 style="display:none;" id="titolo-quiz">Quiz a Scelta Multipla</h1>
Â  <div class="stats" id="stats-container" style="display:none;">
Â  Â  <div><strong>Punteggio:</strong> <span id="punteggio">0</span></div>
Â  Â  <div><strong>Domanda:</strong> <span id="contatore">0</span></div>
Â  </div>
Â Â 
Â  <div class="progress-container" id="progress-container" style="display:none; background-color: #444; border-radius: 30px; margin-bottom: 20px; overflow: hidden;">
Â  Â  <div id="progress-bar" class="progress-bar-animate" style="width: 0%; height: 14px; background: linear-gradient(to right, #ff416c, #ff4b2b);"></div>
Â  </div>
Â Â 
Â  <div class="card" id="card-container" style="display:none;">
Â  Â  <div id="domanda" style="font-size: 1.4em; font-weight: bold; border: 2px solid #007bff; padding: 20px; border-radius: 10px; background-color: #2a2e3d; color: white; margin-bottom: 20px;">Caricamento...</div>
Â  Â  <div id="risposte"></div>
Â  Â  <div id="feedback" style="margin-top: 15px;"></div>
Â  </div>
Â Â 
Â  <div class="controls" id="controls-container" style="display:none; text-align:center;">
Â  Â  <button onclick="domandaPrecedente()">â¬…ï¸ Indietro</button>
Â  Â  <button onclick="prossimaDomanda()">â¡ï¸ Avanti</button>
Â  Â  <button class="btn-danger" onclick="terminaTest()">ğŸ›‘ Termina Test</button>
Â  Â  <button onclick="ricomincia()">ğŸ”„ Ricomincia</button>
Â  Â  <button onclick="tornaAiQuiz()">â¬…ï¸ Torna al Menu</button>
Â  </div>
Â Â 
Â  <div id="recap"></div>

Â  <div id="docente-container" style="display:none;">
Â  Â  <h1>ModalitÃ  Docente</h1>
Â  Â  <div id="lista-docente"></div>
Â  Â  <div style="text-align:center;">
Â  Â  Â  <button onclick="tornaAiQuiz()">â¬…ï¸ Torna al Menu</button>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  let docenteMode = false;
Â  Â  let rispostaCorretta = "";
Â  Â  let punteggio = 0;
Â  Â  let ultimaDomanda = null;
Â  Â  let risposteUtente = [];
Â  Â  let indexDomanda = 0;
Â  Â  let quizCorrente = 1;
Â  Â  let MAX_DOMANDE = 0;
Â  Â  const FEEDBACK_DELAY = 200;Â 

Â  Â  function setDocenteMode(mode) {
Â  Â  Â  if (mode) {
Â  Â  Â  Â  const pwd = prompt("Inserisci la password per accedere alla modalitÃ  docente:");
Â  Â  Â  Â  if (pwd !== "admin123") {
Â  Â  Â  Â  Â  alert("âŒ Password errata!");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  docenteMode = mode;
Â  Â  Â  document.getElementById("start-container").style.display = "none";
Â  Â  Â  document.getElementById("quiz-buttons").style.display = "block";
Â  Â  Â  document.getElementById("quiz-title").textContent = mode ? "Tutti i Moduli (ModalitÃ  Docente)" : "Seleziona una Lezione";
Â  Â  Â Â 
Â  Â  Â  const lezioneContainer = document.getElementById("lezione-container");
Â  Â  Â  const mod1 = document.getElementById("moduli-lezione-1");
Â  Â  Â  const mod2 = document.getElementById("moduli-lezione-2");
Â  Â  Â  // NUOVA VARIABILE PER LEZIONE 3
Â  Â  Â  const mod3 = document.getElementById("moduli-lezione-3");
Â  Â  Â  
Â  Â  Â  const btnBackLez = document.getElementById("btn-back-lezione");
Â  Â  Â  const btnBackMode = document.getElementById("btn-back-mode");

Â  Â  Â  if (mode) {
Â  Â  Â  Â  // Docente: Mostra TUTTI i moduli a cascata
Â  Â  Â  Â  lezioneContainer.style.display = "none";
Â  Â  Â  Â  mod1.style.display = "grid";
Â  Â  Â  Â  mod2.style.display = "grid";
Â  Â  Â  Â  mod3.style.display = "grid"; // MOSTRA ANCHE LEZIONE 3
Â  Â  Â  Â  btnBackLez.style.display = "none";
Â  Â  Â  Â  btnBackMode.style.display = "inline-block";
Â  Â  Â  } else {
Â  Â  Â  Â  // Studente: Mostra scelta lezione
Â  Â  Â  Â  lezioneContainer.style.display = "block";Â 
Â  Â  Â  Â  mod1.style.display = "none";
Â  Â  Â  Â  mod2.style.display = "none";
Â  Â  Â  Â  mod3.style.display = "none"; // NASCONDI INIZIALMENTE LEZIONE 3
Â  Â  Â  Â  btnBackLez.style.display = "none";
Â  Â  Â  Â  btnBackMode.style.display = "inline-block";
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // Funzione per mostrare i moduli della lezione specifica
Â  Â  function mostraModuliQuiz(lezione) {
Â  Â  Â  document.getElementById("lezione-container").style.display = "none";
Â  Â  Â Â 
Â  Â  Â  // Nascondi tutti prima
Â  Â  Â  document.getElementById("moduli-lezione-1").style.display = "none";
Â  Â  Â  document.getElementById("moduli-lezione-2").style.display = "none";
Â  Â  Â  document.getElementById("moduli-lezione-3").style.display = "none"; // NASCONDI LEZIONE 3

Â  Â  Â  // Mostra quello selezionato
Â  Â  Â  if(lezione === 1) {
Â  Â  Â  Â  document.getElementById("moduli-lezione-1").style.display = "grid";
Â  Â  Â  } else if (lezione === 2) {
Â  Â  Â  Â  document.getElementById("moduli-lezione-2").style.display = "grid";
Â  Â  Â  } else if (lezione === 3) { // NUOVA CONDIZIONE PER LEZIONE 3
Â  Â  Â  Â  document.getElementById("moduli-lezione-3").style.display = "grid";
Â  Â  Â  }

Â  Â  Â  // Gestione bottoni navigazione
Â  Â  Â  document.getElementById("btn-back-lezione").style.display = "inline-block";
Â  Â  Â  document.getElementById("btn-back-mode").style.display = "none";
Â  Â  }

Â  Â  // Funzione per tornare indietro alla scelta Lezione 1 / Lezione 2 / Lezione 3
Â  Â  function tornaAlleLezioni() {
Â  Â  Â  document.getElementById("moduli-lezione-1").style.display = "none";
Â  Â  Â  document.getElementById("moduli-lezione-2").style.display = "none";
Â  Â  Â  document.getElementById("moduli-lezione-3").style.display = "none"; // NASCONDI LEZIONE 3
Â  Â  Â  document.getElementById("lezione-container").style.display = "block";
Â  Â  Â Â 
Â  Â  Â  document.getElementById("btn-back-lezione").style.display = "none";
Â  Â  Â  document.getElementById("btn-back-mode").style.display = "inline-block";
Â  Â  }

Â  Â  // Fetch generico della domanda dal server
Â  Â  async function fetchDomanda(index){
Â  Â  Â  // Assumo che i percorsi dei file siano `/quiz/ordered_questions1` (per quizCorrente=1)
      // e `/quiz/ordered_questions11` (per quizCorrente=11)
      // Per i nuovi quiz 11-15, l'URL sarÃ : /quiz/11/0, /quiz/12/0, ..., /quiz/15/0
Â  Â  Â  return await fetch(`/quiz/${quizCorrente}/${index}`);
Â  Â  }

Â  Â  function aggiornaPunteggio(){
Â  Â  Â  punteggio = risposteUtente.reduce((acc,item)=> acc + (item && item.esito ? 1 : 0),0);
Â  Â  Â  document.getElementById('punteggio').textContent = punteggio;
Â  Â  }

Â  Â  async function caricaDomanda(){
Â  Â  Â  if(MAX_DOMANDE===0){
Â  Â  Â  Â  // Fetch per sapere quante domande ci sono nel quiz corrente
Â  Â  Â  Â  const res = await fetch(`/quiz_all/${quizCorrente}`);
Â  Â  Â  Â  const tutte = await res.json();
Â  Â  Â  Â  if(!tutte.errore){ MAX_DOMANDE = tutte.length; document.getElementById("contatore").textContent = `0/${MAX_DOMANDE}`; }
Â  Â  Â  }
Â  Â  Â  if(indexDomanda >= MAX_DOMANDE){ mostraRecap(); return; }

Â  Â  Â  const domandaData = await fetchDomanda(indexDomanda);
Â  Â  Â  if(domandaData.errore){ mostraRecap(); return; }

Â  Â  Â  ultimaDomanda = domandaData;
Â  Â  Â  const domandaElem = document.getElementById('domanda');
Â  Â  Â  domandaElem.textContent = domandaData.domanda;
Â  Â  Â  // Reset animazione
Â  Â  Â  domandaElem.style.animation = 'none';
Â  Â  Â  domandaElem.offsetHeight; /* trigger reflow */
Â  Â  Â  domandaElem.style.animation = "fadeInUp 0.6s ease";

Â  Â  Â  document.getElementById('contatore').textContent = `${indexDomanda+1}/${MAX_DOMANDE}`;
Â  Â  Â  document.getElementById('progress-bar').style.width = Math.floor(((indexDomanda+1)/MAX_DOMANDE)*100) + "%";
Â  Â  Â  rispostaCorretta = domandaData.corretta;

Â  Â  Â  const risposte = [...domandaData.risposte].sort(() => Math.random()-0.5);
Â  Â  Â  const container = document.getElementById('risposte');
Â  Â  Â  container.innerHTML = "";
Â  Â  Â  document.getElementById('feedback').textContent = "";

Â  Â  Â  risposte.forEach((r,i)=>{
Â  Â  Â  Â  const btn = document.createElement('div');
Â  Â  Â  Â  btn.className = 'risposta';
Â  Â  Â  Â  btn.style.animationDelay = `${i*0.1}s`;
Â  Â  Â  Â  btn.textContent = r;
Â  Â  Â  Â  btn.onclick = () => verificaRisposta(btn,r);
Â  Â  Â  Â  container.appendChild(btn);
Â  Â  Â  });

Â  Â  Â  const salvata = risposteUtente[indexDomanda];
Â  Â  Â  if(salvata){
Â  Â  Â  Â  const tutte = document.querySelectorAll('.risposta');
Â  Â  Â  Â  tutte.forEach(el=>{ el.onclick=null; el.style.pointerEvents='none'; });
Â  Â  Â  Â  if(salvata.esito) document.getElementById('feedback').textContent="âœ… Corretto!";
Â  Â  Â  Â  else document.getElementById('feedback').textContent="âŒ Sbagliato!";
Â  Â  Â  Â  tutte.forEach(el=>{
Â  Â  Â  Â  Â  if(el.textContent===salvata.rispostaUtente){ if(salvata.esito) el.classList.add('corretta'); else el.classList.add('sbagliata'); }
Â  Â  Â  Â  Â  if(!salvata.esito && el.textContent===rispostaCorretta) el.classList.add('corretta');
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  aggiornaPunteggio();
Â  Â  }

Â  Â  function verificaRisposta(elemento,rispostaUtenteSelezionata){
Â  Â  Â  if(risposteUtente[indexDomanda]) return;

Â  Â  Â  const tutte = document.querySelectorAll('.risposta');
Â  Â  Â  tutte.forEach(el=>el.onclick=null);

Â  Â  Â  const esitoCorretto = rispostaUtenteSelezionata===rispostaCorretta;
Â  Â  Â  if(esitoCorretto) { elemento.classList.add('corretta'); document.getElementById('feedback').textContent="âœ… Corretto!"; }
Â  Â  Â  else { elemento.classList.add('sbagliata'); document.getElementById('feedback').textContent="âŒ Sbagliato!"; tutte.forEach(el=>{ if(el.textContent===rispostaCorretta) el.classList.add('corretta'); }); }

Â  Â  Â  risposteUtente[indexDomanda] = {
Â  Â  Â  Â  domanda: ultimaDomanda.domanda,
Â  Â  Â  Â  rispostaUtente: rispostaUtenteSelezionata,
Â  Â  Â  Â  corretta: rispostaCorretta,
Â  Â  Â  Â  esito: esitoCorretto
Â  Â  Â  };

Â  Â  Â  aggiornaPunteggio();
Â  Â  Â  setTimeout(()=>{ indexDomanda++; caricaDomanda(); }, FEEDBACK_DELAY);
Â  Â  }

Â  Â  function prossimaDomanda(){ indexDomanda++; caricaDomanda(); }
Â  Â  function domandaPrecedente(){ if(indexDomanda>0){ indexDomanda--; caricaDomanda(); } }

Â  Â  function mostraRecap(){
Â  Â  Â  document.getElementById('controls-container').style.display='none';
Â  Â  Â  document.getElementById('domanda').textContent="ğŸ“Š Test completato!";
Â  Â  Â  document.getElementById('risposte').innerHTML="";
Â  Â  Â  document.getElementById('feedback').textContent="";

Â  Â  Â  let recapHTML="<h2 style='margin-bottom:20px;'>Riepilogo Risposte</h2><div>";
Â  Â  Â  risposteUtente.forEach((item,i)=>{
Â  Â  Â  Â  if(!item) return;
Â  Â  Â  Â  const corretta = item.rispostaUtente===item.corretta;
Â  Â  Â  Â  recapHTML+=`
Â  Â  Â  Â  Â  <div class='domandaRecap'>
Â  Â  Â  Â  Â  Â  <div><strong>${i+1}. ${item.domanda}</strong></div>
Â  Â  Â  Â  Â  Â  ${!corretta? `<div><strong>Tua risposta:</strong> <span style="color:red;">${item.rispostaUtente}</span></div>` :``}
Â  Â  Â  Â  Â  Â  <div><strong>Risposta corretta:</strong> <span style="color:lightgreen;">${item.corretta}</span></div>
Â  Â  Â  Â  Â  Â  <div><strong>Esito:</strong> ${item.esito ? 'âœ… Corretto' : 'âŒ Sbagliato'}</div>
Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  });
Â  Â  Â  recapHTML+="</div>";

Â  Â  Â  const corrette = risposteUtente.filter(r=>r && r.esito).length;
Â  Â  Â  const sbagliate = risposteUtente.filter(r=>r && !r.esito).length;
Â  Â  Â  const nonDate = MAX_DOMANDE - risposteUtente.length;

Â  Â  Â  recapHTML+=`<h3 style="margin-top:20px; text-align:center;">Statistiche Risposte</h3>
Â  Â  Â  Â  <canvas id="graficoRiepilogo" style="max-width:500px; margin:auto; display:block;"></canvas>
Â  Â  Â  Â  <div style="margin-top:20px; text-align:center;">
Â  Â  Â  Â  Â  <button onclick="ricomincia()">ğŸ”„ Rifai questo Quiz</button>
Â  Â  Â  Â  Â  <button onclick="tornaAiQuiz()">â¬…ï¸ Torna al Menu</button>
Â  Â  Â  Â  </div>`;

Â  Â  Â  document.getElementById('recap').innerHTML=recapHTML;

Â  Â  Â  const ctx=document.getElementById('graficoRiepilogo').getContext('2d');
Â  Â  Â  new Chart(ctx,{
Â  Â  Â  Â  type:'bar',
Â  Â  Â  Â  data:{
Â  Â  Â  Â  Â  labels:['Corrette','Sbagliate','Non Risposte'],
Â  Â  Â  Â  Â  datasets:[{
Â  Â  Â  Â  Â  Â  label:'Risposte',
Â  Â  Â  Â  Â  Â  data:[corrette,sbagliate,nonDate],
Â  Â  Â  Â  Â  Â  backgroundColor:['#28a745','#dc3545','#6c757d']
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options:{
Â  Â  Â  Â  Â  responsive:true,
Â  Â  Â  Â  Â  plugins:{
Â  Â  Â  Â  Â  Â  legend:{display:false},
Â  Â  Â  Â  Â  Â  datalabels:{
Â  Â  Â  Â  Â  Â  Â  anchor:'end', align:'end', color:'white', font:{weight:'bold',size:14},
Â  Â  Â  Â  Â  Â  Â  formatter: function(value){ return value; }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  scales:{
Â  Â  Â  Â  Â  Â  x:{ ticks:{ color:'white' } },
Â  Â  Â  Â  Â  Â  y:{ beginAtZero:true, ticks:{ color:'white', stepSize:1 } }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  plugins:[ChartDataLabels]
Â  Â  Â  });
Â  Â  }

Â  Â  function ricomincia(){
Â  Â  Â  punteggio=0; indexDomanda=0; risposteUtente=[];
Â  Â  Â  document.getElementById('punteggio').textContent="0";
Â  Â  Â  document.getElementById('recap').innerHTML="";
Â  Â  Â  document.getElementById('controls-container').style.display='block';
Â  Â  Â  document.getElementById('progress-container').style.display='block';
Â  Â  Â  caricaDomanda();
Â  Â  }

Â  Â  function terminaTest(){ indexDomanda=MAX_DOMANDE; mostraRecap(); }

Â  Â  async function iniziaQuiz(quizId){
Â  Â  Â  quizCorrente=quizId;
Â  Â  Â  document.getElementById('quiz-buttons').style.display='none';
Â  Â  Â  if(docenteMode){
Â  Â  Â  Â  document.getElementById('docente-container').style.display='block';
Â  Â  Â  Â  caricaModalitaDocente();
Â  Â  Â  } else {
Â  Â  Â  Â  punteggio=0; indexDomanda=0; risposteUtente=[]; MAX_DOMANDE=0;
Â  Â  Â  Â  document.getElementById('punteggio').textContent='0';
Â  Â  Â  Â  document.getElementById('recap').innerHTML='';
Â  Â  Â  Â  document.getElementById('titolo-quiz').style.display='block';
Â  Â  Â  Â  document.getElementById('stats-container').style.display='flex';
Â  Â  Â  Â  document.getElementById('card-container').style.display='block';
Â  Â  Â  Â  document.getElementById('controls-container').style.display='block';
Â  Â  Â  Â  document.getElementById('progress-container').style.display='block';
Â  Â  Â  Â  caricaDomanda();
Â  Â  Â  }
Â  Â  }

Â  Â  async function caricaModalitaDocente(){
Â  Â  Â  const res=await fetch(`/quiz_all/${quizCorrente}`);
Â  Â  Â  const domande=await res.json();
Â  Â  Â  const container=document.getElementById("lista-docente");
Â  Â  Â  container.innerHTML="";
Â  Â  Â Â 
Â  Â  Â  if(domande.errore || domande.length === 0) {
Â  Â  Â  Â  Â container.innerHTML = "<h3>Nessuna domanda trovata per questo modulo.</h3>";
Â  Â  Â  Â  Â return;
Â  Â  Â  }

Â  Â  Â  domande.forEach((d,i)=>{
Â  Â  Â  Â  let html=`<div class="card"><div style="font-size:1.2em; margin-bottom:10px;"><strong>${i+1}. ${d.domanda}</strong></div>`;
Â  Â  Â  Â  d.risposte.forEach(r=>{
Â  Â  Â  Â  Â  if(r===d.corretta) html+=`<div class="risposta corretta">âœ”ï¸ ${r}</div>`;
Â  Â  Â  Â  Â  else html+=`<div class="risposta">${r}</div>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  html+="</div>";
Â  Â  Â  Â  container.innerHTML+=html;
Â  Â  Â  });
Â  Â  }

Â  Â  function tornaAiQuiz(){
Â  Â  Â  document.getElementById('titolo-quiz').style.display='none';
Â  Â  Â  document.getElementById('stats-container').style.display='none';
Â  Â  Â  document.getElementById('card-container').style.display='none';
Â  Â  Â  document.getElementById('controls-container').style.display='none';
Â  Â  Â  document.getElementById('docente-container').style.display='none';
Â  Â  Â  document.getElementById('progress-container').style.display='none';
Â  Â  Â  document.getElementById('recap').innerHTML='';
Â  Â  Â  document.getElementById('quiz-buttons').style.display='block';

Â  Â  Â  if (docenteMode) {
Â  Â  Â  Â  // Docente: tutto visibile
Â  Â  Â  Â  document.getElementById("lezione-container").style.display = "none";
Â  Â  Â  Â  document.getElementById("moduli-lezione-1").style.display = "grid";
Â  Â  Â  Â  document.getElementById("moduli-lezione-2").style.display = "grid";
Â  Â  Â  Â  document.getElementById("moduli-lezione-3").style.display = "grid"; // MOSTRA ANCHE LEZIONE 3
Â  Â  Â  } else {
Â  Â  Â  Â  // Studente: torna alla selezione lezioni (Home)
Â  Â  Â  Â  tornaAlleLezioni();Â 
Â  Â  Â  }
Â  Â  }

Â  Â  function tornaAllaModalita(){
Â  Â  Â  document.getElementById('quiz-buttons').style.display='none';
Â  Â  Â  document.getElementById('start-container').style.display='block';
Â  Â  Â  document.getElementById('lezione-container').style.display='none';
Â  Â  Â  document.getElementById('moduli-lezione-1').style.display='none';
Â  Â  Â  document.getElementById('moduli-lezione-2').style.display='none';
Â  Â  Â  document.getElementById('moduli-lezione-3').style.display='none'; // NASCONDI ANCHE LEZIONE 3
Â  Â  }
Â  </script>
</body>
</html>
